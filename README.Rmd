---
output: github_document
bibliography: bib.bib
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-"
)
```

# Reproduce the Results of @gerard2019data

## Introduction

This repository contains the code and instructions needed to reproduce all of
the results from @gerard2019data.

If you find a bug, please create an
[issue](https://github.com/dcgerard/reproduce_fasims/issues).

## Instructions

1. Download and Install PEER: <https://github.com/PMBio/peer/wiki>. I had
   to build the R package from the cloned repository, as installing it from
   the source package didn't work for me.
   
2. Download and install powsimR: <https://github.com/bvieth/powsimR>.

3. Install the appropriate R packages
    ```{r, eval = FALSE}
    install.packages(c("seqgendiff",
                       "tidyverse", 
                       "BiocManager", 
                       "vroom", 
                       "fastICA", 
                       "ssvd",
                       "sparsepca",
                       "elasticnet",
                       "doSNOW", 
                       "ggthemes",
                       "latex2exp"))
    BiocManager::install(c("SummarizedExperiment", 
                           "pcaMethods", 
                           "sva",
                           "edgeR",
                           "DESeq2", 
                           "limma"))
    ```

4. Download data from the GTEx portal: <https://gtexportal.org/home/>. You'll
   need to place the following files in the "data/gtex" folder:
   
    1. GTEx_Analysis_2016-01-15_v7_RNASeQCv1.1.8_gene_reads.gct
    3. GTEx_v7_Annotations_SubjectPhenotypesDS.txt
    5. GTEx_v7_Annotations_SampleAttributesDS.txt
    
    I cannot release these data, but it's free to sign up for access to GTEx.

5. Adjust the Makefile. Change the `nc` and `rexec` variables in the Makefile
   according to your local computing environment. For example, you would need
   to decrease `nc` if you have fewer than 12 CPU cores. You can check the 
   number of CPU cores you have by typing the following in R:
   
    ```{r, eval=FALSE}
    parallel::detectCores()
    ```

6. Run `make`. To reproduce all of the results in the paper, 
   just type in the terminal
   
    ```{bash, eval=FALSE}
    make
    ```
    
    To just reproduce the results comparing the `powsimR` datasets to the 
    `seqgendiff` datasets, run in the terminal:
    
    ```{bash, eval=FALSE}
    make powsimr
    ```
    
    To just reproduce the differential expression simulations, run in the terminal:
    
    ```{bash, eval=FALSE}
    make diff_exp
    ```
    
    To just reproduce the factor analysis simulations, run in the terminal:
    
    ```{bash, eval=FALSE}
    make FAsims
    ```
    
    To just reproduce the plot of the flexible class of mixtures of binomials
    and negative binomials, run in the terminal:
    
    ```{bash, eval=FALSE}
    make NBplots
    ```
    
    To just reproduce the simulations evaluating the Monte Carlo correlation
    estimator, run in the terminal:
    
    ```{bash, eval=FALSE}
    make corest
    ```
    
7. Get coffee. Though most of the results will be generated rather quickly, 
   the `make FAsims` call will take a very long time (mostly because of PEER). 
   You should get some coffee! Here is a list of some of my favorite places:

    - Washington, DC
        - [Colony Club](https://www.yelp.com/biz/colony-club-washington)
        - [Grace Street Coffee](https://www.yelp.com/biz/grace-street-coffee-georgetown)
        - [Shop Made in DC](https://www.yelp.com/biz/shop-made-in-dc-washington)
    - Chicago
        - [Sawada Coffee](https://www.yelp.com/biz/sawada-coffee-chicago)
        - [Plein Air Cafe](https://www.yelp.com/biz/plein-air-cafe-and-eatery-chicago-2)
    - Seattle
        - [Bauhaus Ballard](https://www.yelp.com/biz/bauhaus-ballard-seattle)
        - [Cafe Solstice](https://www.yelp.com/biz/cafe-solstice-seattle)
    - Columbus
        - [Yeah, Me Too](https://www.yelp.com/biz/yeah-me-too-columbus)
        - [Stauf's Coffee Roasters](https://www.yelp.com/biz/staufs-coffee-roasters-columbus-2)

## Package Versions

If you are having trouble reproducing these results, check your package 
versions. These are the ones that I used:

```{r, echo = FALSE, message=FALSE, warning=FALSE, results='hide'}
package_vec <- c("seqgendiff",
                 "tidyverse", 
                 "BiocManager", 
                 "vroom", 
                 "fastICA", 
                 "ssvd",
                 "sparsepca",
                 "elasticnet",
                 "doSNOW", 
                 "ggthemes",
                 "latex2exp",
                 "SummarizedExperiment", 
                 "pcaMethods", 
                 "sva",
                 "edgeR",
                 "DESeq2", 
                 "limma",
                 "peer",
                 "powsimR")
lapply(package_vec, library, character.only = TRUE)
```

```{r}
sessionInfo()
```

Note that I've also only tried this on Ubuntu.

## References
    

